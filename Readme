----------------------------------------
//014 [2006/11/28] by Rayce

・mmo.hに定義されていて実体がcore.cにある状況が気持ち悪いので、eAのようにutils.c, utils.hを追加
　共通で汎用的に使う関数をここに集めることにします
・各ファイルにおけるincludeの整理と整形

・version.hの ATHENA_*** を AURIGA_*** に改名しておく（httpd.c, version.h, login.c, char.c, clif.c, map.c）
・AurigaはModではないので、AURIGA_MOD_VERSION は未定義にする予定です
　パッチ番号はRevisionに合わせるつもりです
　つまり現在のversionは「Auriga-0.0.14」になります
　今のところAURIGA_MOD_VERSIONに関しては改名してmodを0にしただけであり、正式に修正されていません

・既に廃止されている zlib_win32.h, zconf_win32.h を削除するためにdspファイルの修正
・ジャーナルをオンにしてVCでコンパイルすると unlink() で警告が出るので remove() に変更しておく（journal.c）

----------------------------------------
//013 [2006/11/27] by Rayce

・battle_calc_weapon_attack() の修繕その６
	-> 「防御無視判定および錐効果ダメージ計算」の項目において、左手がある場合にのみ
	　 battle_athena.confのleft_cardfix_to_rightを適用するように修正
	-> 「対象の防御力によるダメージ減少」の項目において、左手用の防御無視フラグ calc_flag.idef_ が
	　 判定に全く関与していなかった問題を修正
	-> 「カードによる左手ダメージ追加処理」の項目は左手があるときだけ行うように改善

・clif_party_xy() と clif_party_hp() の引数 *p は未使用なので削除（clif.*, party.c, pc.c）
・cp_setpos() でOnPCMapMoveを実行するかどうかの判定処理を少し修正（pc.c）

----------------------------------------
//012 [2006/11/26] by Rayce

・マップのduplicateシステムとしてmap_athena.confのキーに availmap を追加（char.*, chrif.c, map.*, pc.c）
	例えばpronteraを常設のイベントMAPとして利用したいと考えた場合、元々のpronteraは使えなくなってしまいます。
	そのためgrf内のpronteraのMAPファイルをコピーし、別の名前に変更してユーザーにパッチとして配布する必要がありました。
	このシステムはパッチ配布という煩わしさを解消し、手軽にMAPのコピーを作成できるようにサーバ側で「すり替え」を行うためのものです。
	map_athena.confに例として以下のように記述。
		availmap: duplicate.gat,prontera.gat
	サーバ側ではduplicate.gatとして読み込みますが、クライアント側にはprontera.gatとして認識させます。
	要するにitem_avail.txtやmob_avail.txtのすり替えと同じもので、pronteraが擬似的にコピーされます。
	詳細はdoc/conf_ref.txtを参照のこと。

・@whereを少し仕様変更（atcommand.c）
　　@where [キャラ名] のようにキャラ名の部分は可変にします。
　　キャラ名が指定されない場合は自分自身のMAP情報が出力されます。
　　これは上記のコピーマップに対応するためのもので、自分が居る実際のMAP名を得ることができます。
　　（ /whereだとpronteraとして表示されてしまいますが、@whereだと正常にduplicateとして表示されます ）

・map_athena.confで指定したMAP名が不正な場合、mapデータベースから削除されなかった問題を修正（map.c）
　MAP名の判定は map_readallmap() ではなく map_addmap() で行うようにします
　参照元のMAP名は記述が間違っていても map_readmap() 内部で弾かれますが、コピーのMAP名はそれがないので厳密にMAP名のチェックを行います
　また不正な名前であった場合には "invalid map name!! (???)" が出力されます

・doc周りの更新
	conf/help.txt, doc/client_packet.txt, doc/conf_ref.txt

----------------------------------------
//011 [2006/11/25] by Rayce

・battle_calc_weapon_attack() の修繕その５
	-> 左手判定があるときだけwd.damage2を計算するようにする
	　 計算用のマクロ ATK_FIX, ATK_ADD を追加
	-> ブランディッシュスピアの攻撃力計算式がおかしかったので修正（Lv上昇に伴う倍率加算がなくなってた）
	-> 細かい整形
・010において警告が出るので修正（script.c）
・カイトで反射時にエフェクトを表示するように修正（battle.c）
	reported by rei in Athena Project Forum and refered to eAthena, thx

----------------------------------------
//010 [2006/11/24] by Rayce

・スクリプトのcsvアクセス命令/関数において、ファイル名のチェック処理をまとめた script_csvfilename_check() を追加
	merged from Athena-2262, thanks to T.Nさん
・doc/client_packet.txtを更新

・battle_calc_weapon_attack() の修繕その４
	-> battle_calc_base_damage() の引数を変更
	　 右手だけのときは左手の分の計算を行わないように改善
	　 また左手判定がある場合にはこの関数を2回呼び出してそれぞれ計算を行うことにします

　※右手だけのときは左手の計算をしないので高速化されますが、左手があるときは2回演算するので逆に遅くなります
　　しかし戦闘の大部分を占めるのは右手だけのときなので、全体的には高速化されているはずです
　※右手素手で左手武器の場合本来ならば右手の計算は不要ですが、左手のみという状況は限りなく少ないので
　　高速化のために右手は必ず計算します

----------------------------------------
//009 [2006/11/24] by Rayce

・battle_calc_weapon_attack() の修繕その３
	-> 各計算項目をナンバリングし、計算手順を明確化する
	-> ダメージ計算を始める前に左手武器があるかどうかを判定する
	　 スキル攻撃の場合は左手のダメージは反映されないので、左手武器が必要と判定されるのは通常攻撃だけ
	-> 既にDEF無視フラグが立っているときは「対象の防御力によるダメージの減少」の項目内の計算そのもの
	　 を行わないように処理改善
	-> 全体的に細かい整形

・battle_calc_damage() を少し修正し直し
・新ログインパケット？0x277をサポート（login.c）
	merged from Athena-debug2264, thanks to KADP

----------------------------------------
//008 [2006/11/24] by Rayce

・battle_calc_weapon_attack() の修繕その２
	-> クリティカル攻撃にならないと事前に確定しているものはクリティカル計算そのものを行わない
	-> テコンの蹴り構えを複数同時使用した状態のとき、アプチャオルリギの発動優先順位を最低にする
	-> 連撃判定部分の整形
・MAP鯖のコンソールにもversion表記を出力させる（map.c）
・bcc32_clean.batでmapファイルとtdsファイルも消去するように追加

----------------------------------------
//007 [2006/11/23] by Rayce

・battle_calc_weapon_attack() の修繕
	-> この関数内で全般的に参照する必要あるフラグ変数をまとめた calc_flag 構造体を用意
	　 変数名を変更しただけで基本的な構造は変えてません、rh, lhは準備だけ
	-> ソウルブレイカーのランダム追加ダメージの計算方法を修正

----------------------------------------
//006 [2006/11/23] by Rayce

・005でatcommand_athena.confの変更を忘れてたので同梱
・スタック破壊を修正（int_homun.c）
	merged from Athena-2262, thanks to T.Nさん

・スクリプト命令/関数のバグ修正（script.c）
	-> 以下のスクリプト関数のおいて、スタックに返り値がプッシュされずサーバクラッシュを引き起こすため修正
	　 またこのようなクラッシュを応急処置的に防止するために run_func() を少し修正
	　 　getarraysize, getequipid, getnpctimer, sc_ison, getguildcastle, getrepairableitemcount,
	　 　countitem, countcartitem, checkoption
	-> menu/selectでキャラクターがアタッチされてないときはキャンセル扱いにして終了させる
	-> sc_ison関数で状態異常のtypeが不正な値かどうかをチェックするよう強化

----------------------------------------
//005 [2006/11/22] by Rayce

・battle_skill_attack() で「何もしない」判定されたときは矢を消費しないようにしてみる
・battle_calc_weapon_attack() で最初にターゲットのクラスを得るように変更
・battle_calc_weapon_attack() で魅惑のウィンクや強制移動状態であるかどうかの判定を行わないように変更
	この関数はダメージ計算を行うだけに留め、状態によって判定するかどうかは呼び出し元で行うべきなので
	battle_weapon_attack() と battle_skill_attack() でそれぞれ判定をするようにしています

・@help系統の仕様変更（atcommand.*）
	conf/help1.txt（同様に2,3,4）に追記し忘れることが多いので、@help1,2,3,4は廃止
	代替方式として@helpを「@help [開始行] [終了行]」のように引数を可変にします
	行指定しない場合は全てのヘルプを表示します
	指定した場合は開始行〜終了行のヘルプだけを表示します
	ただし0は指定なしを意味します
	また行頭に // を付けるとコメントアウトと見なされ、その行は表示されません
	　　例）@help 0 20  -> 最初の行〜20行目まで表示
	　　　　@help 10 0  -> 10行目〜最後の行まで表示
・conf/help.txtの整理

----------------------------------------
//004 [2006/11/22] by Rayce

・battle_attr_fix() を少し改善
・battle_calc_damage() の処理改善
　特にダメージが発生する場合で、アジトの情報が不要な場合でも情報を検索していた無駄が省かれます

・MAP名に "this" 指定可能なスクリプト命令/関数を考慮して、MAP番号を取得する処理をまとめた関数
　script_mapname2mapid() を用意（script.c）
・以下のスクリプト命令/関数においてMAP名の "this" 指定に対応
	mapannounce, areaannounce, getareadropitem, setmapflagnosave, setmapflag, removemapflag,
	pvpon, pvpoff, gvgon, gvgoff, maprespawnguildid
・MAP非配置型のNPCからmap_foreachinarea() を呼び出す命令/関数を実行されるとアクセス違反が生じる可能性があるので
　map_foreachinarea() でindexの値のチェックを入れるように修正（map.c）

----------------------------------------
//003 [2006/11/22] by Rayce

・battle_calc_weapon_attack() の構造変更によって、001の時点で矢のATKが計算されない
　可能性が生じていたので修正（battle.c）
・battle_calc_weapon_attack() を全体的に整形
・battle_delarrow() の引数を増やして battle_skill_attack() からでも使えるように共通化（battle.*）

・item_arrowtype.txtとitem_group_db.txtで存在しないアイテムIDだった場合は読み飛ばすように修正（itemdb.c）
・item_db.txtでアイテムIDが20000までしか使えない制限を取り払う（atcommand.c, itemdb.*）
	-> 読み込まれたデータの中で最大のID値をmax_itemidに保存しておくように変更
	-> itemdb_getmaxid() を追加
	-> 上記変更に伴って @idsearch を少し修正

・チェイサーのスキル名と混同するので、スキルの使用条件を示す ST_CLOAKING 等の名称を ST_*** → SST_*** に変更（skill.*）
　ST_CHASEWALKというstateは存在せず誤っているので、新しくSST_CHASEWALKINGを定義
　skill_require_db.txtのstateの項目にchasewalkingを追加

----------------------------------------
//002 [2006/11/21] by Rayce

・囲まれ判定用の定数 ATK_LUCKY, ATK_FLEE, ATK_DEF をmap.hからbattle.hに移動
・使われていない定数 MS_IDLE, MS_WALK, MS_ATTACK, MS_DEAD, MS_DELAY をmap.hから削除
　（mob.hの MSS_*** に変更されている）
・使われていない定数 SAB_NORMAL, SAB_SKIDTRAP をskill.hから削除
・ほとんど意味がないので AS_ATTACK, AS_REVENGE をskill.hとbattle.cから削除
・ほとんど意味がないので MAX_STATUS_TYPE をmmo.hとatcommand.cから削除

・pc.cとskill.cの distance() を削除し unit_distance() に置き換え
・一部のdouble型へのキャストをatn_bignumber型に置き換え
・homun_data構造体の変数名を atackable → attackable に変更（clif.c, homun.c, map.h）
・unit.cを少しだけ整理

----------------------------------------
//001 [2006/11/21] by Rayce

・Auriga始動
・サーバースナップショット
・ATHENA_MOD_VERSIONを1に変更（version.h）
・不要なファイルを削除
　　doc/sc_start.txt, bin/tool/convert.c

　※上記以外には変更を加えてないので、実質Athena-dev-2.1.1-mod2261までを集約したSSに相当します
　　このversionを以ってAurigaのスタートとします
　　細かい部分は「Athena」のままですが、今後変更していく予定です

----------------------------------------

    Athena Dev. v2.1.1       Released: Middle July, 2003
    (c) 2003 Athena Project.
     http://project-yare.de/

1. Athena(アテナ)について
2. このリリースについて
3. 必要な物
4. 使い方
5. 現在の仕様
6. 祝辞
7. 免責事項
8. 募集
9. English


1. アテナについて
    アテナとは2003年1月半ばにでた0052.lzhをベースとして作られているエミュレータの一つです。
    基本的なライセンスはオリジナルがGPLの下に配布されている為、
    これに従いGPLの下配布を許可します。
    /*
        改良版を配布する場合は必ずこのREADMEを書き換えてください。
        何処を改良したのか報告(athena@project-yare.deまで)して貰えると助かります。
        バイナリのみの配布はGPL違反ですので"必ず"ソースも添付してください。
     */
    動作の確認は以下の通りのみ行っています。
    // ただし完璧に動く事を保証するものでありません
    対象CPU: Intel Pentium系   // PentiumII以上で確認.
        FreeBSD 4.8R, 4.6.2R
        Linux RedHat 7.3
        cygwin + gcc 3.2 20020927 (prerelease)
    開発元URL: http://project-yare.de/


2. このリリースについて
    今回のリリースは前回(V2.1)同様開発版のリリースのみです。
    2.1に比べ下記の点が修正されています。
        mapのデフォルト設定が韓国data.grfのみ正常に動作するようになっていた点
        common/timer.cやmap/script.cの幾つかのバグ

    迅速にUpdateを強く推奨するものではありませんが各自の判断で行って下さい。


3. 必要な物
    data.grf      //sdata.grfは必要に応じて
    account.txt   //存在しない場合athena.shが自動生成します
    conf/*.cnf    //Map用とChar用の二種類あります
    conf/npc*.txt //npc設定用ファイルです。複数のファイルに分けることが可能です。
    db/*.txt      //アイテム、job情報など


4. 使い方
    > tar xvfz athena-d?.?.tar.gz
    > cd athena-d?.?.tar.gz
    > make
    > vi conf/char_athena.cnf       //IP(127.0.0.1)の部分を環境に合わせて変更してください
    > vi conf/map_athena.cnf        //同上、またmap設定などは、このファイルで行います。
    > ./athena.sh
    上記を行えば"たぶん"起動します。

    補足:
    conf/npc_sampleJ.txtにはスクリプトの書き方について色々な説明が記載されています。
    もし、独自のMap設定を行ってみたい人や、スクリプトを弄りたい方は参考にしてください。
    ただし、開発中のためスクリプトの仕様が変更される可能性が高いです。
    command.txtには実装済みの特殊コマンドについての説明を記載しています。


5. 現在の仕様
    本鯖と比べておかしい(例えばプバが歩く、ポリンがアイテムを拾わないなど)点は、
    全て現在開発中に因るものです。
    現状としてキャラクタ系及びモンスター系のバグ報告は無視される可能性が高いです。

    バグ報告について必ず発生条件をお書き下さい。
    下にある報告用テンプレートを使って報告して頂くと助かります。
    報告先はエミュ板の開発スレにでも。
    ---- Athena v 2.0 (stable or develop) ----
    【gcc ver】gcc -vを実行時に表示される内容
    【動作システム】FreeBSD, Linux(ディストリビュージョンも), cygwinなど
    【発生内容】mapが落ちてしまった時の表示されていたデバッグ情報など具体的に書いてください。
    【操作内容】具体的にどんな操作を行ったかを書いてください。
    ------------------ END -------------------
    理想はテンプレに加えてmap.coreなどcoreファイルをUploaderにアップして頂くことですが
    問題のMapだけの状態にしcoreの吐く容量に注意してください。
    /*
        確認した限りでは324個ほどmapデータを読み込ませると、
         40MB近いcoreファイルを吐き出します @FreeBSD
         cygwinの場合はstackdumpというファイルになるそうです。
        しかし、coreファイルなどをgzip圧縮などすれば大幅に小さくなります。
         大凡30MBのcoreファイルが2.9MBほどになるようです。
        ですので、もしアップロードする場合はgzip圧縮など各自行ってください。
     */

    今回のリリースだけでなくHISTORYを作成すると大量に記述が必要な為省略しています。
    // 多い日だと本当に結構ありますので‥‥。


6. 祝辞
    今回このAthena開発版を出すに当たって感謝したい方々(順番不同)
        Lemming氏 (Project YARE)
        0052氏 (Uploader)
        35氏 (エミュ開発スレ)
        Johan Lindh氏(Author of memwatch)
        YARE forumのNPC情報を作成した方々
        weiss研究会BBSの様々な情報ファイルを作成した方々
        最後に、.coreファイル達


7. 免責事項
    Athena Projectは一切Athenaの動作に関する保証等は行いません。
    つまり、Athenaは無保証です。
    athena@project-yare.deに動作・操作等に関する質問などを送られても一切お答えできません。
    又Athenaを用いたことにより生じた被害・問題等の責任は一切Athena Projectは負いません。


8. 募集
    athenaの開発に参加したい//興味があるという方ご連絡下さい。
    我々は貴方の参加をお待ちしています。
    // 最新版が欲しいだけで何ら協力して頂けないという方はお断りです;-)
    [募集要項: プログラマ(2-3人)]
        年齢: 不問
        性別: 不問
        言語: 日本語が理解可能
        内容: C言語もしくはC++による開発。(特にネットワークやDBの経験が有る方大募集!)
    [募集要項: 翻訳(?人)]
        年齢: 不問
        性別: 不問
        言語: 日本語、英語が理解可能
        内容: 仏蘭西語、独逸語、西班牙語、伊太利亜語、泰(タイ)語、朝鮮語、中国語へ文献、サイトなどの翻訳
    連絡先: athena@project-yare.de 雑務担当まで。


9. English
     This release is just fixed some bugs in timer.c, script.c and map_athena1.conf.


(c) 2003 Athena Project.
