----------------------------------------
//0285 [2007/08/22] by Rayce

・pointshopを2007-07-11aSakexe以降のクライアントに対応（clif.c）
	0x289のパケット長を見て処理分岐しています。
	0x288に付属してる末端の4byte分は謎なので無視。

・doc/client_packet.txt更新

・SQL: `hotkey` テーブルにKEYを張り忘れてたので追加（Auriga285_changetable.sql）


●New Project Name
	「Auriga」オリガ
	馭者座の学名、アテネ王になったエリクトニオス（Erichthonius）を指す
	Athena（アテナ）の子の意味を添えて
	エリクトニオスはまたアテナを祀っていたことからリスペクトを示す（Panathenia）

●おかしい点
　１．ボウリングバッシュのガーターを実装する
  ２．細かい点i
	・ファイアーピラーの同時設置可能数は5個までですが無限に置けてしまいます。
	・本鯖ではＧｖＧ時にエンペリウムにセイフティウォールが有効なのですが無効になっております。
  ３．細かい点ii
	・スキルユニットの足元置を有効にした状態でアクティブMOBが通過直前のセルにファイアーピラーを設置しても掻き消されるだけで効果が出ない場合があります。
  ５．NPCチャットのメンバーにNPCを入れる
　◆６．ソウルドレイン
		by luc
	・MaxSPを増加させ、対象指定魔法で敵撃破時にSPを吸収する。
	・吸収SP量は、敵レベルｘSP吸収率。
	・NB、NV、FBLは指定した対象のみSP吸収することができる。
	・オブジェクト設置魔法(大魔法,HD,FW等)で倒した場合はSP吸収は発動しない。
	・Mob:AにJT→先行入力でJTをしたとき、最初のJTで倒した時点でSP吸収が発動するが、Mob:AにJT→先行入力で敵BにJTをしたとき、Aを倒したときのSP吸収は発動しない。
	・発動モーションは移動等で簡単にキャンセルできる。
	・重量が50%を超えていてもSDは発動する。
	・ソロ効率の引き上げにとても便利だが、前提となるスキルが厳しいのが難。
	・しかしながら、対象指定魔法での撃破が条件の為、複数目標を一気に殲滅する高LVになってくるにつれて、必要なくなってくる場合も。
	・SPRの上位互換として見た方がいいかもしれない。
	・Lv1でも十分すぎる吸収量、高LvはMSP増加による自然回復量増加の効果が大きい。
	・Lvを上げすぎると対人戦において教授のソウルバーンが脅威となる。
	・MCや打撃で倒した場合はSDは発動しない。
	・上昇したMSPによる自然回復や単体指定魔法を多用する狩場での吸収により、常時ECする余裕が生まれるため、ソロ時の生命力upに繋がると言えなくもない
　７．by Blaze
	Athena2021にて
	・「ポーションピッチャー」をMobが使えない。

	・取り巻きの手下の挙動で、Athenaでは親の範囲内に入った時点で行動終了（片寄ってしまう）、
	本鯖では範囲外に出た時、範囲内に入るように親の周りにランダムで移動
　８．by @w@
	◆・KP100溜まっても赤ネームにならない。
	・デモンなどが足元置き可能（skill_unitで足元不可にしても可能)
　９．by Mana
	・本鯖ではソニックブローは完全固定ディレイ
	　(athenaではブラギで速くなっているので
	　 固定ではないと思います

	・錬気功が気弾５個ある時にスキルが失敗する様になっている
	　(現行版athenaでは失敗せずに使用される)

	・PvPでPTを組んでいると味方には攻撃があたらない
	　(現行版athenaでは味方に攻撃があたるようになってる)
　11．by 逆毛鰻
	memmgr: args of aFree is invalid pointer int_guild.c line 1461
	memmgr: args of aFree is invalid pointer int_guild.c line 1592

	0001 : int_party.c line 412 size 852
　14．mobやホムの利用できるスキルを拡張する
	現状だとsdに限定されたスキルがいくつかあるのでそれを使えるようにしたい
	modeの拡張版みたいな感じでmd->passiveとか作って、「拘束しないで」とか魔法無効とか
	PCのパッシブスキルと同様に永続的に続くものを追加したい
		→sc_dataのeternalで実装するか！？
  16．by amm
	過去にでているかもしれませんが。
	MOD2038、SS1990において
	SGによって凍結した敵が滑る現象が起こりません。
	これによって通称FWSG割りと呼ばれる技が使えません。
	また、IW一枚張りと呼ばれる物も使えない様です。
	サーバー仕様によるものだと思いますが
	ご参考までにマジスレテンプレへのリンクを張っておきます。
　18．Gv中に赤ダメージが見える、MISSも？
  19．battle_delay_damageで距離チェックとか入れる from eA
　23．IW足元置きのときに抜けられない
  27．オーラブレードに属性倍率が乗っているバグ
  29．武器精錬の確率が合ってる？
  32．+10ブーツにＤＬｃ挿してるんですが
	オートスペルのエフェクトは出るのにダメージが出ません。
	どうすれば直りますかね？それとも仕様ですか？
  33．カードによるコーマでExp入る
　36． Re:本鯖相違スレッド４ / Mag / 06/06/15 18:00 / No.5278 / ID:iG.GpZM   
	・バーサク前にかけたパリィが発動しない
	・ソードブレイカー、メイルブレイカーにある武器・防具破壊効果が
	通常攻撃にしか載らない。本来は物理攻撃（反射含む）であれば載る
	・ストームガスト、ロードオブバーミリオンの効果が重複する
	・オートカウンターのクリティカルが100％発動しない
	転生パッチにより100％クリティカルになりました
	・クリティカル攻撃時、過剰精錬していない武器でもダメージにばらつきがある
	クリティカルは最大ATKなので過剰精錬がない場合はダメージは一定のはず

  42．遠距離攻撃にはロードオブデスカードのコーマは乗らない
  45．	金ゴキ盾を装備しても
	ハイプリスキルのアスムはかかりました
  48．ソウルリンカーのスキルで2つバグを発見しました。
	・カアヒ(攻撃を受ける度にHP回復）を使って攻撃を受けてもHPが回復されない
		-> 回復後にダメージが発生してる
　51．ｺﾞﾞｽﾘﾝがサイトであぶりだせないのです ・ﾟ・(つД｀)・ﾟ・ 
  55．ガンスリンカーのスキル「マッドネスキャンセラー」を使用中（作動中）に
	　移動しないとターゲットを取れない場所にいるモンスターをクリックした場合に移動してしまう事が数回ありました。
	　もちろんマッドネスキャンセラー作動中なので　動いてしまった後も一定時間が経つまでは　動けません。
　57．未実装の新カード
	　◆RSX-0806カード（ノックバックしなくなるが未実装） 
	　ラウレル=ヴィンダーカード（魔法で倒すと〜が未実装なため、魔法に限定しない。） 
	　リムーバカード（精錬値が上がるほど〜が独自仕様）
  61．やっぱりボスが何故かアンクル踏み潰すときがある
　62．黄金蟲カードを装備しても、ホーリーライトでダメージ受けるのですが仕様ですか？
  63. MOBAIの見直し
  64．[113] Re:バグ報告スレッド１２ / Mag / 06/07/09 04:41 / No.5446 / ID:iG.GpZM   
	 QMにかかった際にAGI・DEXの減りが、ステータス補正の方を
	半減しているようです 
　74．養子系
	要請失敗時のパケットを探す
　76．[47] Re:本鯖相違スレッド４ / 初心者 / 06/07/19 07:35 / No.5509 / ID:3e3iCb6  
	 オークロードカードのシーズモードの効果について
	相手が阿修羅を撃った場合、反射ダメージで撃った人が死ぬと、自身はノーダメージになります。
	PvPでは自身も反射ちゃんとダメージが出ています 
  77．リロード時に変更パケットを全員に送りつけるようにしたい
	（clif_skillinfo_blockをclif_foreachclientで送りつける予定）
  80．skill_additional_effect() は基本的には敵に何か与えるときに使う
	自分の状態異常を付加したりはここではしない（敵が死んでるときにはこの関数は呼ばれない）
	いまのとこは武器スキルはdelayと整合性がとれてないから大丈夫だけど、いずれは改善必至
  81．LUCY : mobに攻撃して死んだやつが居た場合、他のやつにExpが100%いく
	dmg_logの処理方法が本鯖式になってないのか？
  84．[51] Re:本鯖相違スレッド４ / Kiry. / 06/07/23 15:43 / No.5558 / ID:3WPd/..  
	ノビの魂で、本鯖では、リログ時と、マップ間移動時に装備が強制解除されるそうです。
  98．[69] Re:本鯖相違スレッド４ / Hyoga / 06/07/31 01:16 / No.5671 / ID:m0E6X4Q   
	スクロールによるディレイキャンセルが出来ないようです。

	※ディレイキャンセル
	ストームガストやメテオストーム等、使用後ディレイの長い魔法が発動している間に
	アイテムの魔法スクロール（ヒールや各種ボルト）を使用すると、その魔法のディレイが上書きされ、
	先に唱えた魔法よりもディレイを短くする事が出来る。
	自己ブラギのような感じ。

	例:SG発動(ディレイ5秒）→ヒールスクロール使用（ディレイ1秒。コレが優先される）→SG詠唱開始（まだ前のSGは発動中）
　99．[75] Re:本鯖相違スレッド４ / 　 / 06/08/02 00:26 / No.5702 / ID:./4QuO.   
	Athenaでは、プレイヤーがホムンクルスをタゲれないようです。
	本鯖ではタゲれます。
　100．89] Re:バグ報告スレッド１３ / y / 06/08/01 22:42 / No.5695 / ID:pq4LAGY   
	PvPモードで検証しました。
	ソウルブレイカーの魔法ダメージ部分はMDefを無視して与えられるのですが、種族耐性(人間型耐性と遠距離攻撃耐性)も無視して与えられているようです。
	以上、報告でした。
  111．[118] Re:バグ報告スレッド１３ / あちゃこ / 06/08/04 05:50 / No.5771 / ID:EpFLDIw  
	0001 : skill.c line 10356 size 40
	0100 : script.c line 2586 size 20
	0101 : skill.c line 10351 size 80
	0200 : ..\common\db.c line 571 size 16
	0289 : script.c line 2591 size 4
	0296 : script.c line 2589 size 768
	memmgr: args of aFree is invalid pointer npc.c line 1885
　113．[84] Re:本鯖相違スレッド４ / RIN / 06/08/04 22:58 / No.5780 / ID:SUZhgYk  
	 ウィザードのファイアーピラーですが、本鯖ではサイトブラスターを
	当てるとダメージ数値を重ねる事が可能になっています。
	FP自体のエフェクトはそこに残りますが、たとえば進行方向上に
	三つ並べてその上を通過すると末端部分で合計ダメージが入ります。
	罠と同じ扱いになっているみたいですが、エフェクトが固定なので
	ダメージ計算だけ飛ばす処理になっているみたいです。
  115．[86] Re:本鯖相違スレッド４ / queue / 06/08/05 07:26 / No.5785 / ID:3PW4EKs  
	ランドプロテクタについてなんですが、Lv5の範囲が公式だと
	11*11になってるが、実際は最外周のLPセルではLPの効果がない
	なのでエフェクトは11*11だが効果は9*9

  122．GvでのASPD190制限ですが砦外で191以上にしてから中に入ると何らかのステータス変化(一部のステータス以上含む)が起こるまで190にはならないようです　これはいかが　　　 なものでしょうか？
	→ clif_LoadEndAck() で status_calc_pc() を呼べば解決するが、頻繁にやるのはアホらしいので
	　 battle_configでスイッチするか、状態異常保存の実装時についでに手を加える（どうせstatus_calc_pcしないといけなくなりそう）
　◆123．eAをベースにしてclif_LoadEndAck() を最適化したい
	見てると結構不要な処理やパケット送信が見られるので…Aegisのパケットキャプチャしてみて比較するのも手かも。要検証。
  126．タオグンカｃの効果についてなんですが、装備なしのパラにタオｃ挿し鎧を
	挿した所、ＨＰが３０２６２→５０４３７になり、大体ＭＡＸＨＰ＋６０％
	位しかＨＰが上がっていないようなのですが、確認お願いします(_ _(--;(_ _(--;
	>>139

	AWAKE鯖では仕様でHPを150％にしているわけですが
	その50％分のHPが
	タオグンカｃに適用されていないのかと思われます
　130．[28] Re:バグ報告スレッド１４ / Kiry. / 06/08/13 00:27 / No.5932 / ID:3WPd/..  
	PvGvでのリジェクトソードによるダメージの半分反射が、
	半分ずつ、自分と相手に分かれていないようです。
	athena2167 txt bcc win2kを使ってます。 
		-> 恐らく反射ダメージにPvGv補正が入ってない、計算のタイミングが違う
		   実際は反射ダメージはアスムにより半減前のものらしいのでその辺も合わせないといけない
		   また計算場所は最終ダメージ計算ではなく、リフレクトシールドと同じところの方がいいかも？
　132．[50] Re:バグ報告スレッド１４ / あちゃこ / 06/08/19 18:10 / No.5983 / ID:PHrjzbU   
	お世話になります。Athena2169 winXP BCC
	どうやら検証らしきものができましたので報告。
	memmgr: memory leaks found
	0001 : skill.c line 10341 size 40
	0005 : skill.c line 10336 size 80
	0009 : ..\common\db.c line 571 size 16
	リヒ3FのMobがわんさかいるところでメテオストームやストームガストの
	範囲攻撃スキル？を連発していると出てきます。単にmobの攻撃を受けて
	突っ立ってるだけでは出てこないです。
	取り巻きかと思いmobのid1650を召喚してスキルを乱発しても出てきません
	数なのかなと思いつつ。
  137．[72] Re:バグ報告スレッド１４ / Cocoa / 06/08/23 07:14 / No.6018 / ID:GGvKG.I  
	・既に夫婦に養子がいる場合、同アカウント別キャラで養子にする要請が飛ばせません。
	アカウントAにキャラA、キャラBがいるとして、
	アカウントBにキャラC、
	アカウントCにキャラDがいるとします。
	キャラAとキャラCが結婚して養子を迎えているとします。
	キャラBとキャラDか結婚して養子を迎える為に要請を出そうとすると、
	キャラBからは要請がだせず、キャラDからしか要請がだせません。
  140．ダメージのタイミング合わせる
	本鯖はディレイダメージ後にHPの減少とダメ―ジパケが来てる
	（Athenaはパケが来てからダメージ減少してる）
  142．ベースのATKやダメージが本鯖の実測と合わない
	たぶんみすとれ巣の計算式を参考にしてると思われるが、ROratorioとは合わない
	（ROratorioは本鯖にほぼ忠実な計算をしてるっぽい）
	ダメージ計算手順や方法を１から見直す必要はあると思う
  144．るー
	AがBに攻撃→Bがダメージを食らう前にAへ反射ダメージが行っています。
	本来はAがBに攻撃→Bがダメージを食らう→反射→Aがダメージを食らう。
	こういう順番だと思うのですが、どうなのでしょう･･･？
  145．名前：ARIA 2006/08/31 08:47 ID:???
	チャージアタックの相違点
	本鯖
	・シーズモードでは移動効果無し。 
	・詠唱中に攻撃を受けるとキャンセルされる。
	Athena
	・シーズでも移動する。
	・キャンセルされない。
  146．テンプレサイトによると、サイトラッシャーは内周と外周で威力が変わるみたい
  147．名前：Hyoga 2006/09/03 00:39 ID:???
	Athena2197 BCC
	スキル「穏やかな休息」「楽しい休息」の効果が
	1.近くにテコン系キャラが居なくても発動する。
	（説明上は近接にテコン職必要）
	2.移動時（直立含む）にも時間計算されている。
	（10秒歩いて（もしくは立って）座るといきなり回復）
  149．空蝉による位置移動は0x1ffで飛ばすようです（その後0x88で移動停止させる）
	というか全体的に移動系統は整理したいところ…
  150．畳替えし
	　　■		■は0.396916secと、異常に早く消える
	　　■		■は2.894734secと、かなり長く存在？
	■■□■■
	　　■
	　　■
　151．名前：Blaze ◆vIWhDK7Q 2006/10/22 12:15 ID:Uqa9cneB
	【確認したAthena】2240
	【確認した本鯖時期】ノーグハルトパッチ後

	script命令、nextの仕様について、
	・本鯖ではnext実行後、次の命令が実行されるまでに500msのタイムラグがあります。
		-> next; if(sleep2(500) <= 0) end; ... とすればいいだけ
	・next表示後、60000ms（1分）表示したまま実行しないと、nextがcloseに強制変換されます。

	・NPCスキル、喫煙はダメージ表記はありますが、実際にはノーダメージです。

	・Athenaではリンク属性Mobのリンク判定が追跡時になっていますが、
	本鯖では攻撃時にリンク判定します。

	・速度変化ポーション（速度増加の方）の移動速度は50（プレイヤーの最高速度）でした。

	・MobのTF_HIDING（ハイディング）は、隠れたままでもほとんどのスキル使用が可能です。

	・モンスター召還系のスキルは、値n * SkillLv 匹召還ではなく、値1〜5合わせてSkillLv匹分まで召還です。
	召還数判定は値1から順番に行われているようです。

	・メタモルフォース、トランスフォーメーションも召還系同様、SkillLv匹分変化のようです。
	例）盗蟲の卵→盗蟲x4、土精→土精x2
　152．ガンスリンガーのスキルについて
	フライング、最大コイン5枚消費してとなっているが、1枚しか消費しない
	マジカルバレット、コインを1枚消費してとなっているが、消費しない
	デスペラードが遠距離攻撃扱いになってる、敵との距離でHit数の減少が無い



●構想
　１．DestinyのシステムをWaltherに共存させる
　　　MAP鯖を分割すればsrc等を独立化できるので、mapについてはそれでOK
　　　inter経由のものは色々対策する必要あり（Whisやアナウンス等は全然問題無し）

	倉庫は第二倉庫を用意する、storage_txt2 ?
	openstorageでの呼び出しに対して処理を分岐させれば可能、ギルド倉庫も同様にやる
	ホムやペットが問題ありか？（Destinyサイドでは完全無効にする？）
	PTやギルドの共存はDestinyサイド入り口で排除すればいいだけなので大丈夫そう

　２．装備品に耐久度を付ける
　　　TWっぽく戦闘の度に耐久値が減少し、0になったら壊れて消失する

　３．連携技の実装
　　　ロマサガっぽく連携技や合体技、特定の陣形によるダメージ増加など
　　　実装自体は難しくないと思うが、仕様を決めるのが大変、かなり練りんでバランス取らないと危険

	陣形はPTメンバーに対してsd->bl.m, sd->bl.x, sd->bl.yを参照し、陣形dbみたいなものと符合すればOKみたいな感じ
	連携はmobに連携専用タイマーを用意しておいて一定間隔内に特定のスキルを食らったら
	ダメージの増加やエフェクトの追加などを行えばいい
	合体技はキャスティングありのスキル限定でやらせる
	味方のキャスティング内にタイミングよくキャスティングを開始すれば別のスキルとして発動する
	キャスティングキャンセル→再度キャストでリスタート可能

　４．mobの強さを継代する
	ロマサガっぽく戦えば戦うほど敵が強くなっていく
	mobは倒されてもspawnならblock_listに結束したままなので、そこからデータの引継ぎをする
	鯖を落としたときは強さの向上度合いを算出して（各MAPごと？）保存しておく
	再起動時にその割合に合わせてmobのステータスを適当に付加する
	強さは基本的にリセットされない仕組みにしておくので、鯖起動時間が経過すればそれだけmobの強さが底上げされる
	スキルの閃きやスキル発動率の向上、出来ればAIの向上（これはさすがに元のsrcにAIを実装しないと無理か･･･）

　５．アイテムレンタル制度
	レンタル残り時間、利率、貸し出し主などの情報を格納しておく必要がある
	item構造体に入れるとデータ量が肥大化してしまう恐れあり
	外部にtree_dbを用意してそれに入れておくか？
	インターバルタイマーでキャラのセーブと同様にフラッシュしないといけないなど、既存の機構とは別に作る必要が
	あるので、果たしてどちらが楽か？

　６．mob攻め擬似Gv
	mobが攻め手になるGv
	通常mobとは別のAIを用意しないとエンペに向かって走ったりしない
	BL_MOBではなくBL_PCとして実装できれば、装備品を付けたりできるので本格的なGvに近い形ができる
	パケットの送り付けさえ殺せばできる気がするので、socket.cにダミーfdデータとかを用意して
	やらせるのがよさそう


●スクリプト案
　・オプティマイザ
	- forやwhileループ内の関数を外の追い出す
		while('@i < getarraysize('@list)) → set '@__a,getarraysize('@list); while('@i < '@__a)
	- forの初期化を省略化
		for(set '@i,0; ; set '@i,'@i+1)
		'@iが初出ならset不要
	- 連続mesの連結
		mes "aa"; mes "bb"; → mes "aa\nbb";
		ただし+演算子を使った文字列連結や変数が含まれる場合は注意が必要
		mes '@str$; mes "cc"; → mes '@str$ + "cc";
	- switchテーブル
		アセンブラのようにswitchテーブルを用意してダイレクトジャンプさせる

　・条件判定の遅延評価（ショートサーキット）
	if(A == B && C == D) のとき、A != B なら C == D を評価しない
	( ) の階層による評価順を決めてバイナリコードへ変換しなければならない

　・switchの内部変数を特殊化
	MAP一時変数に値を保存せず、script.cに直接用意されたstatic変数に格納して参照する
	実行速度自体の高速化とstr_bufの数を減らすことによる高速化が見込める

　・範囲を持つcase
	case 1 ... 3:

　・caseに文字列を渡せる
	case "aa"; ただし条件判定の遅延評価が実装できないとコストが高く付く

　・var宣言子（pragma）
	varで変数を宣言してから使うことを強要する
	変数のtypoを容易に検出できる
	デバッグモードとしてscript_configでスイッチできると良い

　・連想配列
	setd/getdでやるか、一般的なハッシュを使ってkey/dataの組み合わせを作るか
	setd/getdの方が多次元配列と同義なので実装は楽

　・構文の追加
	- foreach
		foreach('@list,'@val) { mes '@val; }
		文字列や連想配列をどう扱うか
		配列の添え字を取得できるように拡張すべきか
	- expandarray
		select(expandarray('@list,5))
		可変引数を取る命令/関数のみで有効
		配列を展開してスタックにpushする
		C_NAMEでpushすべきかどうか、C_NAMEだと速度的に遅くなりそうな気がするが
		callfuncなどで使ってgetargで値を戻す場合が想定されるのでC_NAMEが無難か？

　・命令/関数の追加
	- pusharray, poparray
		pusharray '@list,5;
		配列の末尾に値を押し込む、あるいは取り出す
		getarraysizeを実行することなく値を格納できる利点はあるが、利用する場面があるかどうか
	- eval
		eval "set @menu,select("aa","bb");";
		柔軟なコーディングを可能にできるが、コンパイル時にエラーチェックできない
		実行時に判断するので危険、エラーチェックを強化しないといけないか？
		関数依存変数の引継ぎが難しい

	- fork
		forkが必要な場面が思いつかないが･･･
		donpceventとsleepを駆使すれば同様の機能はできそうだが･･･

	- next2
		一定時間後にnextをcloseにする本鯖機能
		nextに特化するか汎用で色々な命令に対してタイマーを持てるようにすべきか
		イベント型NPCで重複アタッチなどを考慮しないといけない場合、現状ではかなり煩雑なので
		これをある程度緩和できるようにしたいところ
	- getattachedcount
		そのNPCにアタッチされている数を返す
		'lockの代わりに使える
		PCのログアウト時も自動的に考慮されるので、自前でロックを用意するよりも楽かもしれない

　・プリプロセッサ
	#defineによるマクロ置換と同様の機能を持たせる
	script.cに渡す前の段階で、文字列検索と置換処理を行う
	有効範囲をどこまでにするか、同一ファイル内のみ？#undefは必要？

　・MAP共用変数
	AthenaDevでは '$変数 という案だが、個人的には $$変数 にして欲しいところ
	MAPサーバ分散時のためのものだが、コーディングが複雑化するので使いこなすのがかなり大変
	disable/enablenpcとdonpceventくらいはMAPサーバを越えられるようにしておきたい
	これらは需要次第

　- アイテムスクリプトの高機能化
	アイテムスクリプトから使う場合はmesやcloseなどの範囲チェックを無くす
	現状では制限が掛かっていて使いづらい
	安全性は現状と同様のレベルを確保しないといけない

　・配列の上限拡張
	128個から256個に拡張する
	unsigned intに変更すればもう1bit使えるようになる
	ただしcsvのMAX値も256に上げる必要があるため、csvに使うデータが2倍に膨れる

　・キャラ永続変数の上限解除
	96個制限を取り払い、calloc/reallocでアロケートしていく
	恐らくかなりの量まで増やしても問題ないはず
	charサーバのコンソールに利用している変数の最大値を出力するようにしておけば
	利用者もある程度安心して使えるかもしれない
	また固定長でなくなるので、余分に配列を確保できる
	クローズドハッシュで変数を管理するようにできれば、キャラ永続変数へのアクセスが高速化される
	7〜8割くらい配列が埋まったらメッセージを出力して自動的にreallocできれば良い
	追記で、やはり pc_setglobalreg(), pc_readglobalreg() は重いみたい
	過去の開発板の質問スレを見る限り、1588でクローンスキルを見直したおかげで1587の重さが解消された
	という報告があった
	埋め込み変数も数が増え、スクリプトで使われる変数の数も増えてきてる（特に擬似配列化がやばい）
	ので本格的にテコ入れしないといけない時期なのかもしれない
	よく考えたら何もグローバル変数名を保存しておく必要性はない
	script.cのadd_strを使えば登録番号に変換できるので、キャラ一時変数と同様にindexだけを保持して
	いればよい
	セーブのタイミングでのみstr_buf+str_data[num&0x00ffffff]を行って文字列を取得し、char_fdの
	ソケットバッファにコピーすればよいことになる

　・永続変数の配列対応
	配列を許可する
	MAP永続変数と同じように配列の添え字を保存するようにした方が良いかもしれない

　・永続変数の文字列対応
	eAのようにstaticに256文字持たせるのは少し大きすぎるので別の実装を考える
	一次元の配列を用意して、\0で区切りながら使うようにすれば良い
	script.cのstr_bufと同じ手法


●変数のハッシュ化
　案１）クローズドハッシュ
	変数名をハッシュで刻んでそのままglobal配列を参照する
	コリジョンが発生したら以下のいずれかの方法で回避する
		線形探査（liner probe）
		平方探査（quodratic probe）
		二重ハッシュ（double hash）

	検索と挿入は速いが削除が面倒
	削除された場所はdeletedフラグをオンにして区別する必要がある
	ハッシュテーブルが7〜8割埋まったら自動的に伸張・再構築を行う
	再構築時にdeletedをクリーンアップする、ただし多少のタイムロスが発生するのがネック
	また常に7〜8割までしか使えないのでメモリ領域をより多く喰われる
	その反面既存の処理方法を壊さない

	struct global_reg {
		char str[32];
		int value;
		char deleted;
	};
	sd->save_reg.global = (struct global_reg *)aCalloc(96, sizeof(struct global_reg));

　案２）オープンハッシュ
	変数名をハッシュで刻んでハッシュテーブルに流し込む
	コリジョンが発生したらリンクリストに繋がる
	ただしlinkdb_nodeを使うと小さなアロケートが大量に必要になってしまうので、
	一次元の配列にnext,prevを埋め込んでリストを形成して利用する

	変数が大量に登録されても速度低下が発生しない
	検索・挿入・削除全てが効率的
	global配列を使い切ったらaReallocで自動的に伸張する
	ただし別途ハッシュテーブルを用意しないといけないのがネック
	よくよく見るとtree_dbのちょっと小規模版でしかない･･･

	int hash_table[GLOBAL_REG_HASH];
	struct global_reg {
		char str[32];
		int value;
		int next;
		int prev;
	};
	sd->save_reg.global = (struct global_reg *)aCalloc(96, sizeof(struct global_reg));

　案３）バイナリサーチ
	変数名をadd_strしてユニークな登録番号に変換する
	登録番号順にソートしておいて検索はバイナリサーチで行う
	挿入・削除の度にmemmoveしないといけないので速度面でかなり不利

	しかしながら文字列をstrcmpで比較するより登録番号で比較検索した方が速いのは間違いない
	ヒープソートとかやってみる？

	struct global_reg {
		char str[32];
		int value;
		int num;
	};


●Future Plane
　・@spawnscript, @switchscriptを実装したい
　　NPCを沸かせる命令、eAの@reloadscriptは危険で多くの変更が必要だが１度だけ沸かせるなら低コストで実装可能
　　@switchscriptはNPCのenable/disableをコマンドで行うもので、@spawnscriptを組み合わせて使えば
　　@reloadscriptに相当する動きを実現可能だと踏んでいる
　　script/extension下にnpc_spawn.txtのようなものをデフォルトで置き、ここに書かれたNPCを@コマンドで読み込ませる
　　形式にしてみる（サーバ再起動時にはこれらは読まれない仕組み）
　・next2命令の実装？
　　本鯖仕様にするためのもので一定時間経過後にnextを強制的にcloseに置き換えるもの
　　専用の命令を用意するか、addtimerを巧く改造してイベントトリガーにするか迷い中
　・倉庫ロストの原因究明
　・extraシステムの改造
　　あまり利用され難いシステムの癖に大きいコードなので削除するのも手
　　セーブデータを手動で書き換えたものをサーバ内に直接反映させるためのシステムに昇華したい
　・戦闘関連で、特にダメージの反射のタイミングを最適化する
　　恐らく本鯖と比較して合っていない、反射に関する処理が散らばっているので一箇所に集めるべき
　　skill_additional_effect() とかもeAをベースに巧くまとめたい
　・MobAIをtxtを利用して制御できるようにしたい
　　本鯖仕様の動きすら再現できていないので、mob_ai_db.txtのようなデータベースを作ってスイッチさせる
　　scriptを利用してもいいが…mobが動く度にparseしてたら実行速度が低下する恐れ有り
　・clif.cから余計な処理は極力追い出し、パケットのやり取りを行うだけの部分にしたい（Endさん発案）
　・PC型Mob等に関する改善
　　eAを参考にviewに関する構造体を用意するなどの工夫があってもいいかもしれない
　・conf/battle_athena.confの整理
　　昔開発板にあった整理ヴァージョンのように機能別にカテゴライズするのと、不要なものを除く
　・eAおよびFreyaを参考にキャラ永続変数の96個制限を撤去したい
　　パケットサイズの問題はWFIFORESERVEである程度解消できそうなので、あとは自己管理でやらせる？
　・eAのmalloc_word() を移植
　　memsetに比べてどれだけ高速化されるかチェックする必要あり
　・battle_check_target() の最適化
　　複雑すぎて修正がもはや不可能…
　・プレイヤーの吹き飛び処理を見直し
　　以前吹き飛び時は skill_blown() を使うように変更したが、飛び方がおかしいので巻き戻す
　　unit_movepos() もややこしくなってきているので整理し直す必要あり
　・map_session_data構造体の整理
　　カード効果系の変数が散乱しすぎなので構造化してまとめる、status_calc_pc() の初期化部分が少しは綺麗になる
　・mmo.hのguild_castle構造体から使われて無い変数を削除したい
　　scriptとかにも絡んでいるので漏れなく変更する
　・拡張要素としてホムスキルをPC, Mobが使用可能にする
　　さらにホムがPCスキルを使用可能にする？
　・@speedがダメージを食らったりしてステータス再計算されると元のスピードに戻ってしまうので改善したい
　　sd->base_speedのようなものを専用に用意するか、状態異常として実装するか
　・マジックナンバーを少しずつ減らしていく
　・スキルによるダメージ倍加率をskill_db2.txtとかから読み込むようにしたい
　　倍加系はATK_FIX, MATK_FIXで倍率を指定するだけなので、caseを羅列するよりかはデータベースを使った方がスマート
　　ハードコーディングを避ける、利用者はデータベースの値を変えるだけで気軽にスキルの倍率を変更可能、
　　コードを少し小さくできる、倍率の計算をサーバ起動時にparseして保存しておくので再計算が不要
　　などのメリットがあるので良い方策かもしれない
　・将来的に傭兵システムが実装されてペットやホムと同様の移動ルーチンをとるなら、eAのmercenary.cのように
　　ルーチンをまとめるべき
　　eAにある@cloneslaveとかをmercenaryでやらせるように改造するとか？（eAの場合は単なるsummon）
　・npcskillpos命令にスキルユニットを表示する機能を盛り込むか？
　　発動の瞬間に画面内に居たPCにしか見えない仕様であれば楽に実装可能
　・doc内ファイルの整理
　　conf_ref.txtとか中途半端な状態なので書き直す
　　save_ref.txtにセーブデータの構造とかを書いてもいいかもしれない
　・eA（Rev.9269）ではスクリプトのselect命令の別ヴァージョンとしてprompt命令が実装されている
　　cancelボタンを押してもスクリプトがENDのならずに続行されるシステム
　　返り値および@menuには0xffが与えられる
　　実装するかどうかは需要次第（あまりなさそうな気がするのでこのまま自然消滅か？）
　・MAP名指定が必要なスクリプト命令/関数を "this" 対応化したので、GvGのscriptとかを改善できる
　　即ちgetmapxyが要らなくなるのでもっとスマートなコードに仕上げることが可能
　・skill_require_db.txtのstateがあまり意味を成してない気がするので、skill.cを見直す
　・阿修羅のダメージがオーバーフローすることがある
　　出来ればダメージ計算過程において全てのスキルでオーバーフローしないような仕組みにしたいが…
　　atn_bignumber damage, damage2; を用意して全てatn_bignumberで計算して最後intへキャストするか？
　・mobはPCよりもホムを優先してタゲをとる
　・require itemが複数index検索に対応してない（名前入りポーションとかが検索できない）
　・eAと各種職業のWikiを照らし合わせながら、相違と思われる点を全て修正していく
　　明確な本鯖の情報がなかなか得られずスキルの細かいレベルの修正が困難なため、eAとWikiをある程度信頼した上で
　　取り込めるものは取り込む（特にeAはAegisのパケットレベルで合わせてたりするのでそこそこ信頼できるか？）
　・mallocとaMallocを分離させる
　　確実にメモリリークしないのが保証されてる使い方をする場合で、且つ大きめのデータをアロケートしたい場合は
　　直接mallocを呼び出した方が速い、freeも同様
　　Freyaの実装のようにアロケート出来たか確認するマクロを組む
　・skill_check_condition() 系を上手くまとめ直す
　　SPやアイテム消費部分はPCとHOMでほぼいっしょなはずなので一つの関数として吐き出したい
　　return前に clif_skill_fail() をいちいち書かないといけないので、pre-functionを用意したいところ
　・clif_blown() で吹き飛ばしたあとは0x88（clif_fixpos or clif_fixwalkpos）でストップさせるのが
　　本鯖の仕様らしい、mobが近寄ってこないバグが直る？
　　追記：CAは0x1ffだが、JTは使ってない。clif_fixpos2()と同様の機構で動かしてる模様
　　スキルによって挙動が異なるのか？単発のものは0x1ffで連発のものは0x88併用法なのか？
　　ちなみにストップさせるのはダメージを食らう時点でunit_stop_walking() を呼び出してそこで止めてるので問題ない。
　・C++でもコンパイルできるようにソースを修正する
　　予約語（class, new）が幾つか散見されるので改名したりとか
　　officialにはCのみだが、個人でmodifyしたいときはC++の機能を取り入れることができるため柔軟に対応可能
　　例えば関数のオーバーライドを利用して強引な #define に頼ることなく別動作の関数へ置換したり、とか
　・倉庫処理をまとめる
　　アカウント倉庫とギルド倉庫を一括で処理できるようにすれば、他の種類の倉庫も容易に実装できる
	struct storage {
		int id;		// アカウントID, ギルドID
		short type;	// 種類、STORAGE_ACC, STORAGE_GUILDとか
		short storage_status;
		short storage_max;	// 倉庫サイズ、MAX_STORAGE, MAX_GUILD_STORAGEに相当
		short storage_amount;
		struct item item[1];
	};
　　原理はshop型NPCと同じで、アイテムデータ部分を可変長にする！
	- stor = (struct storage *)aCalloc(1,sizeof(struct storage));
	+ stor = (struct storage *)aCalloc(1,sizeof(struct storage) + sizeof(struct item)*max);
　・右手素手左手武器のとき、右手の攻撃力計算がおかしい？
　・@reloadsavedataを実装する
　　login鯖、char鯖が持っているセーブデータのバッファを破棄して再度読み直す
　　特にSQLだとSQL鯖で書き換えたデータをゲーム鯖内に反映させるための手段として利用する
　　服色で重力エラーを吐いたときなどに鯖を落とすことなくセーブデータを変更して復旧させることが可能
　　SQLだとnumdb_finalするだけなので楽で且つ負荷はほとんど掛からないが、TXTだと
　　再度ファイルを読み込む必要があるのであまり推奨できないかも？
　・char/inter鯖で使われるパケット長のリストをcommon/packetlen.cとかを作って一括管理したい
　　ついでにpacket_db.txtの読み取りもこれに任せるとか
　・ランキングはFreya方式でfame_pointを使う
　　TXTだと全走査するときにstrcmpしなくていいので若干処理速度が改善されるし、SQLだと構造の見通しが良くなる
　　11位以下を保存しておいて、空き詰めが行えるようにしたいところ
　・スキルによるアイテム消費が複数イベントリをまたいでいるとダメなのを修正する
　　名前入りポーションなどが正常に検索されずにスキル使用失敗になってしまう
　　ピラーの処理とストーンカースの処理が一致しないので合わせる
　・SGのあと凍結しながら滑るようにするには unit_can_move() においてopt1を参照して移動不可にしている部分を
　　外してやればよい
　　あとは移動完了地点でどうやって移動不可に切り替えさせるかが問題
　　本鯖の挙動を詳細に（特にPCに対してやった場合はどうか）調べながらやらないといけなさそう
　・スクリプト実行時に型チェックできるようにしたい
　　run_func() でbuildinを実行する前にargを見て、少なくともC_NAMEとC_POSは区別できる
　　eAが現在手入れしている最中だが、v: variable, l: label とかできるかも？
	→追記：出来ない。例えば set func(),1; は不定なため。
　・stack_dataにtype, num/str, refに加えてerrorを用意する
　　push_val3() とかを作ってerror_codeをスタックにプッシュできるようにしておく？
　　エラーを区別したい場合に利用できるのが理想
　・caseラベルの重複チェックを行うかどうかをscript_athena.confでスイッチできるようにしておくのもいいかもしれない
　　eAで意見があったように変数をラベルに書いて動的に扱いたい人もいるかもしれないため
　・duplicate元が重複してたらエラーを出すように強化する
　・grf::data\manner.txtを読み込んで、禁止ワードかどうかを鯖側でも判定する from Freya
　・ギルドマスターがログインしていない場合、getguildmasterid関数でIDを引けない
　　g->masterを map_nick2sd() に通してcharidを返す処理が問題
　　sdが見つからなかった場合はMAX_GUILDMEMBERでループし、g->masterとg->member.nameをstrcmpして
　　マスターであればg->member.charidを返すようにすれば取得できるようになる
　　ただログインしていないマスターのIDが必要な場合があるのか？（attachも出来ないし･･･）
　・extraシステムでアイテムやZenyを渡す際、対象PCがNPCにアタッチされている場合には
　　スクリプトが終了するまでキューに入れて待機させる
　　スクリプト実行中にアイテムやZenyが変動するとnextの度にチェックを入れなければならない
　・サーバ内でスキルの名称が参照できるようにしたい
　　eAではskill_dbにnameとdescメンバが追加されていて、蔵定義名と表示名を取得できるようになっている
　　ハードコーティングは避けたいので出来ればgrf内のskillnametable.txtからデータベースを作りたいが
　　スキルIDと名前を関連付ける方法がない･･･
　　実装できれば例えばgetskillname関数を作ったり、デバッグコードにスキル名を表示できるので
　　コンソールから見るときに楽
　　スキル名からIDを逆引きできるようにしておいてもいいかもしれない（eAでは実装済み）
　・status_changeのSC_系の定義の空きを詰める
　　現在はSI_系に移行してるので詰めてしまっても問題ない
　　ただしやる以上は整理したいので、例えばSC_STONEとかは先頭にまとめるなどeAっぽくしたい
　　今のところ空きが50個くらいなので、50×20×40000匹mob = 40M削減できる！
　　（これは動的確保OFFのときの概算、ONのときはあまり大きな恩恵はない）
　・ペットのtalk_convertでIDが2000以上のものを指定すると台詞が出ないらしい？ from BTS
　・性転換した際、バード⇔ダンサーへ変更されるときにスキルポイントが還元されない
　　きちんと計算するように修正するか、spr系をgrfに用意して性別無関係で出来るように変更、あるいはconf？
　・鯖起動後にギルドメンバーがログインしても接続しましたの文字が流れてこない
	-> 新規ログイン時だけ何故か0x16dをメンバーに送ってもメッセージが流れない
	   eAでも未解決みたいなので本鯖からパケットを採取してくる必要がある
　・武器に名前が入ってる人がキャラ削除すると赤文字の名無しになる
　　どうやらカード欄に入れるIDを0にすると良いみたい
　　キャラ鯖から強制的にUnknownを入れるようになってるけど、上手く制御したいところ
　・タイマーのdismatch警告はリヒ3Fでよく出るが、サイトが原因臭い？
　・hideonnpc命令をしてもマヤパープルカードで見破られてしまう
　　インビジブルにすれば完全に見えなくはなるが、ハイドのエフェクトが出なくなる
	-> 本鯖は見破られる仕様みたいなのでこのまま放置？
　　disablenpc命令のように姿を消す処理をしても即座に消えるわけではないので上手くいかない
　・グラフ機能はコンパイルオプションで無効にできるようにしておきたい
　・monster命令でギルドIDを引数として取る場合の場所を変更する
　　ガーティアン系もハードコーディングを避けたい
　・scriptとfunctionのスクリプトブロック解析を一つの関数にまとめる、eAは変更済み？
　・ゴスペルは有効時間1分で、効果のかかるタイミングは10秒間隔が正しい
　　現状はゴスペルを連打すると何度も効果がかかるみたい？
　・skill_db.txtのinf2の整理
　　使い方に統一性がなさすぎるので調べて上手く形にする
　・リヒのmobがタゲなしの停止時も足踏みしている
　　mobAI関連のバグか？
　　タゲがないときはstopさせつづけないといけない
　　というか敵サーチのAIがどうもおかしい気がする
　・unit_walktoxy_timer() のCELL_CHKNOPATHのチェックを外せばIW1枚ハメが再現できそう
　　本鯖のMobの移動ルーチンだと移動経路途中に出現したIWについては検知しないようなので問題はないはず
　　バジリカと月明かりでも同様にハメが起こるのか？
　・バジリカの仕様がテンプレと違う
　　CELL_CHKBASILICAがあまり有効活用されてない･･･
　・eAでは魔法スキルもamotionのディレイ後にダメージを発生させるようになっている
　　確かにJTとかは上手くエフェクトとダメージの発生がマッチしているように見えるが･･･？
　・eAはJTなどの多段ヒット系のダメージを受けたときは、ヒットが完了するまでをダメージモーションと見なして
　　移動できないようにしている模様
　　jAではJT中でも強引に移動可能、本鯖の仕様は？？
　・スキルユニットと状態異常の関連を正す
　　skill_unit_groupを削除したときは必ずsc_dataの方の情報も削除すること
　　groupのアドレスやunitのblock IDは0にしておかないと他のデータを参照してしまう
　　ダンスは一応対策されているようだが、他のものに関しては曖昧だったりするのでチェックすること
　　例としてはSWがあり、onoutのところでsc_dataのval2を0にしないと危険！
　・グラビテーションフィールドの削除が曖昧？
　・skill_unitやskill_unit_groupとsc_dataの関係について安全性の強化
　　skill_delunitgroup() のときに必ずsc_dataに格納されているアドレスを0にするように徹底する
　・StatusEternalChangeの見直し
　　Infinity Loopが起こりにくくなるように改善したい
　・装備アイテムのUseScriptは装備した瞬間にだけ呼ばれるようにするか、status_calc_pc() のトップレベルで呼ばれる
　　ように変更したいところ
　　EquipScript内では取得できないプレイヤーのパラメータをキャラ一時変数などに保存できるようにするため
　・タイマーのヒープソートをmemmoveしなくて済むように改良する
　　ヒープソートにする？
　・friend_dataもmmo_charstatusから切り離す
　　Freyaの実装を参考にしてみるか？
　・いつの間にかROメールの日付が表示されなくなっている
　　蔵のせい？原因不明
　・expテーブルをグループごとではなく各職業で独立に用意したい、eA方式
　・必要ステータスも同様にeAのようにdbを用意するべき
　　特にLvを999まで上げたりするとステータスポイントが容易にオーバーフローするため
　　ついでにJobポイントもJobLvで1ポイントではなく、可変設定できるように拡張するか？
　・詠唱中の武器持ち替えは可能？
　　本鯖では詠唱完了後のチェックはないようで、本来使えないはずの武器で詠唱開始し、持ち替えて実際の効果は
　　持ち替え後の武器に依存させる方法が一般的に知られている
　・eAのように範囲攻撃の範囲をskill_dbから設定できるようにする
　　splash、0のときは足元の範囲のみ、-1のときは範囲攻撃にしないようにスイッチ可能
　・skill_castend_damage_id() 内の武器スキルの範囲攻撃スキルの処理を出来るだけまとめる
　　魔法スキルはある程度まとまっているようだが、特にGS/NJが加わってから無秩序に散らばっている感じがする
　・範囲攻撃スキルを他PCに使用しても良いかどうかをskill_dbのinf2あたりを使って設定できるようにする
　　inf2自体が既に適当になっていて使われてすらいないビットもあるので、一度整理直したい
　・memwatch.hのインクルードを見直す
　　今のところあらゆるところにincludeしているが、多分malloc.cで一括includeで済むはず
　　ついでにfreeとaFreeを完全分離しておくか？
　・エスマと風刃の回転輪エフェクトがいつの間にか上手く表現されなくなっている
　　使えるIDの範囲が蔵側で変更されていたりするのだろうか？
　　と思ったが、非移動のMobだけ誤作動している感じがする
　・eAのshowmsg.cを移植する
　　コンソールにカラーで打ち出されるのはやはり大きな効果がある
　　ただしエラーログとしてtxtにリダイレクトしてるとカラーの意味がない
　　htmlとかで出力できるように改造するのも一つの手
　・pc_search_inventory() がどうしてもforループなのであまり賢くない
　　ハッシュが使えると良いのだが･･･固定長だと厳しいか
　　アイテムIDからそのままMAX_INVENTORYで剰余をとったものをハッシュ値とし、クローズドハッシュでデータ
　　を格納していけばかなり速くなるか？
　　ただしソートキーidとの兼ね合いが悪くなるのが考えどころ
　・eAのmenu/select拡張をmergeするか
　　"A:B" のようにデリミタで繋いだ文字列も空文字補正と同様に補正して返す
　　setarrayのようなことをしなくても文字列連結でメニューを作ってしまえる利点はある
　・ipとportを保存している変数の型を洗いざらい見直す
　　恐らくipはunsigned int (long?)、portはunsigned shortが正解？
　　でもipに関しては正式にはin_addr_t型みたいなんだけど･･･IPv4？
　・ブラギなどのスキルユニットが他プレイヤーの画面外に移動するとき、エフェクトが残ってしまう
　　画面外になる場合は clif_skill_delunit() を送ってやらないと残像が消えないはず
　・盗作GXを弓装備時に使えない問題
　　多分skill_require_db.txtで使用可能武器に弓を加えるだけで良さそう
　・タロット効果による石化は体が青っぽくなるらしい
　　もしかしたら@misceffectの379番かも？
　・getitem2とかでcard0に0xff00を指定されるとペットアイテムと認識されるため、アイテムを消去する際に
　　inter鯖に削除要求が飛んでしまう
　　ペットの卵はmakepetで生成するべきなので、getitem2では作れないように制限する必要がある
　・氷晶落はLPによって無効になるはずだがなってない？
　　雷撃砕も？0x86のユニット設置型にする必要があるかもしれない
　・マインドブレイカーは減算MDEFが減るはずだが除算MDEFが減っている？
　・プレッシャーがオートガードで防がれたりリフレクトシールドで反射されてしまっている？
　　近接物理攻撃になってるみたいだが正しいのか？
　・ランキングデータの受信が完了するまでキャラが接続できないようにする
　　chrif_stateで判定しているようなのでそこで殺す
　　もしくはMAPデータを受信するときに同時にランキングデータを送り付けるようにするか
　・@usersでnumdbを使わないように変更する
　　int *list = (int *)aCalloc(map_num, sizeof(int)); としてMAPの枚数だけ配列を確保して
　　それに人数を放り込むようにすればnumdbを使う必要はない
　・VC用のpragmaでlibmysqlを読み込むのをやめる
　　vc_make.batで指定するように、BCCと統一する
　・char_load_all() が不必要に呼ばれている可能性があるのでもう一度処理の流れを確かめる
　・GMの設定は各鯖で行わずlogin鯖で統一する、eA式
　　login鯖でconfを読み込んでchar, mapにパケットを送信して流し込む
　　現在廃止中の@gmのパケットを使うか？それとも@gmを復活する？
　・MOB型NPCにはスキルの詠唱が可能なのが本鯖仕様！
　・ギルドメンバーログインパケット0x1f2をサポートする？
　　末端の3つのWORDはそれぞれ01で固定で良いの？
　・@saveからセーブデータの保存処理を切り離す？
　　@savepointという別のコマンドがあってもいいかもしれない
　　ホムやステータス異常のセーブが抜けてるはずなので追加すること
　・sd->bspeedを作る
　　ベースとなる歩行速度で@speedで変更した速度が status_calc_pc() で初期化されないようにする
　・clif_send0078() でMobの場合のギルドIDを入れる箇所がおかしい？
　　22や26番目じゃなくて34や38番目に入れないといけないはず？
　　ガーティアンは攻城戦では頭上にエンブレム出ないんだっけ？
　・skill_blown() の最適化
　　countにデータを詰め込み過ぎなのでeAと同様に引数を増やすべき
　　clif_blown() を使うかどうかはダメージありなしじゃなくて呼び出し元で任意に決めるようにするか？
　・FreyaにあったサーバのAnti Freezingシステム
　　サーバが何かしらの原因でゾンビ化した場合にソケットを落とすことが出来る
　　同一MAPを別の鯖で待機させている場合に威力を発揮できるか？
　・関数の最初のnullpoチェックとNULLチェックの切り分けをちゃんとやる
　　絶対にNULLで来てはならないポインタは全てnullpoにしておくこと
　・npc_touch_areanpc() の処理改善
　　単一MAPに設置されたNPCの数が少ないときは問題ないが、例えば300体とか多い場合には300回ループして
　　該当NPCを探すので効率が悪い
　　map_foreachinarea() の方がこの場合は早いはず
　・MAP名を保存する全ての変数のサイズを16にする
　　map_dbは16文字でstrncmpして検索している上に、char鯖が受け取るMAP名も16文字で規定されている
　　蔵も16文字でやり取りしているので24文字とっている箇所は修正するべき
　　メモリの削減にもなるし統一性が生まれる
　　末尾に \0 を強要すべきなので実質は15文字、しかも .gat が付くので使えるのは11文字
　　でも現状でもギリギリ15文字のMAPがある（xmas_fild01.gat等）
　・aReallocでサイズ縮小をサポートする
　　スクリプトが少しメモリ消費を抑えられる可能性がある
　　またshopが常に101個アイテム用の配列を確保しているので、その辺りも節約できるかもしれない
　　やってみた結果1Mくらい節約されたけど、本当にやる価値あるの？
　・0182で clif_parse_GuildRequestInfo() の呼び出しを止めたが、例えばギルドメンバーがログアウトして
　　情報が変更されたときにその結果が反映されなくなっている可能性がある
　　本鯖はメンバーがLvアップしたとき即座にギルドウィンドに反映されるの？要調査
　・温もり状態でタイリギするとき、敵を引きずっていけない、途中で隣を通過してしまう
　　これは温もりの発生タイミングの問題で、0.2ms間隔で温もりが効果を及ぼすときに上手く敵をノックバックできる位置
　　にいないと温もりが不発して通過してしまうため
　　タイリギの移動速度との擦り合わせ、あるいは微妙な実装仕様変更が必要だと思われる
　・2007-07-12aSakexe以降のためにショートカットキー保存に対応する
　　パケット解析は完了しているのであとは実装するだけ
　　inter鯖で管理してデータのセーブを行うようにするか？
　・set @buf$,""; if(@buf$) {...} のようなとき、"" は偽になるように変更してみる？
　　jump_zero命令でconv_numせずにget_valでデータを取得して、is_strで文字列型かを判定して決める
　・オーラを出すLvをbattle_auriga.confで指定できるようにする
　　パケットを送る部分で参照しているbase_levelを摩り替えればよい、eAを参照のこと
　・ホムの新密度が0になったときの挙動は？
　　鯖側でPETのような処理は含まれてない様子なので、蔵からホム削除パケットが飛んでくるのか？
　　WPEでパケット送信ブロックされたら意味がないので鯖側処理は必要かもしれない
　　と思ったら消滅しない模様？本鯖の挙動と合ってなくない？
　・周囲に移動可能セルがあれば侵入セルの直上でも移動できるのが本鯖の仕様らしい？
　　IW１枚ハメとも関連してきそう
　　恐らくpath_searchの際、[0]を検索から除外すればいい
　・db/job_db1.txtで両手系の武器についてもカラムを増やす
　　左手のASPD計算は今のところ左手の補正は*140/200になっているだけなので、個別にdbで設定できるようにして
　　おいた方が拡張性は向上する
　・linkdbはtreedbと同様に独自のメモリプールを使うようにする
　　linkdb_node型はサイズ20で常に固定であるため、メモリプールを使うようになれば少し高速化される
　・script.cからscript engineとbuildinを分離する
　　buildin.cを作ってscript.hから関数を利用してやりとりする
　　見通しが良くなることと、script engineを他のものに転用する余地を作る
　・mobもPCと同様にdex等でスキルディレイが補正されるようにしたい
　　現状のスキルディレイは固定ディレイとして設定する
　　特にPC型MOBでプレイヤーのエミュレートをしたい場合には有用かもしれない
　　db/mob_db.txtにカラムを一つ挿入しないといけないため、huge cgiとの親和性が薄れてしまう
　　ただしこれを実装すればAthenaProject2311の「MOBはスキル固有のディレイを蟲するように修正」の項目を
　　より柔軟性の高いシステムとして網羅できるというアドバンテージがある
　・ランドプロテクター使用者が死んでも残ったままで消えない
　・アンクルの吸い寄せ関連
　　シーズモードではノックバック無効のためその時点で止まらず、移動先に着くまでアンクルを踏み潰しながら
　　到着時点で停止する
　　ボス属性のモンスターに対しても同様
　　Aurigaの仕様上停止地点の真下にアンクルがないと整合性が取れない状況なので、一度見直しながら上手く
　　実装できる方法を探っていく必要がある
　・新しい蔵だとペットのアクセサリが表示されないらしい？
　・運命のタロットカードは失敗時はSP消費なし
